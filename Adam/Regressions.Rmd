---
title: "Regressions"
author: "Adam Billen"
date: "12/3/2023"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
```{r}
library(tidyverse)
library(nnet)
library(MASS)
library(rpart)
```
MPD regression

For this study, we will conduct four multiple regressions predicting the
use of force in Washington, DC by the Metropolitan Police Department.
Our predictors will be the police district in which the use of force
took place, the date of the incident, the gender and race of the officer
and the age, race, and gender of the subject. The targets will be the
type of use of force, the disposition, the department action, and the
severity of the force. We won't include the other potential targets as
predictors for one another because severity, for example, will likely be
a very high predictor of the type of use of force, muddling our models.
We will not include variables such as case status, when a case closed,
the anonymized officer IDs, or officer assignments as predictors. We
will remove all uses of force against animals, as we are only interested
in cases involving humans.\


```{r}
mpd_dat_2021 <- read.csv('../data/UOF_DC_2021.csv')
mpd_dat_2020 <- read.csv('../data/UOF_DC_2020.csv')
sea_dat <- read.csv('../data/UOF_Seattle.csv')
```



```{r}
age_breaks <- c(18, 25, 35, 45, 55, 65, 100)

mpd_dat_2021 <- mpd_dat_2021 %>%
  mutate(
    subject_age = as.numeric(subject_age),
    AgeBands = cut(subject_age, breaks = age_breaks, labels = c("18_24", "25_34", "35_44", "45_54", "55_65", "66_100"), include.lowest = TRUE, right = FALSE)) %>%
  drop_na(uof_type, IncidentDistrict, OfficerGender, OfficerRace, AgeBands, subject_race, subject_gender) %>%
  mutate(OfficerRace = str_replace_all(OfficerRace, "/", "_")) %>%
  mutate(OfficerRace = str_replace_all(OfficerRace, " ", "_")) %>%
  mutate(subject_race = str_replace_all(subject_race, " ", "_")) %>%
  mutate(subject_race = str_replace_all(subject_race, "/", "_"))

encoded_data <- model.matrix(~ uof_type + IncidentDistrict + OfficerGender + OfficerRace + AgeBands + subject_race + subject_gender, data = mpd_dat_2021)

mpd_dat_enc <- cbind(mpd_dat_2021, encoded_data)

model_seattle_2021 <- glm(serious ~ IncidentDistrict2D + IncidentDistrict3D + IncidentDistrict4D + IncidentDistrict5D + IncidentDistrict6D + IncidentDistrictOther + OfficerGenderMale + OfficerRaceBlack_African_American + OfficerRaceHispanic + OfficerRaceOther + OfficerRaceWhite_Caucasian + AgeBands25_34 + AgeBands35_44 + AgeBands45_54 + AgeBands55_65 + AgeBands66_100 + subject_raceBlack_African_American + subject_raceHispanic + subject_raceOther + subject_raceWhite_Caucasian + subject_genderMale,
               data = mpd_dat_enc)

summary(model_seattle_2021)
```
```{r}
mpd_dat_2020 <- mpd_dat_2020 %>%
  mutate(
    subject_age = as.numeric(subject_age),
    AgeBands = cut(subject_age, breaks = age_breaks, labels = c("18_24", "25_34", "35_44", "45_54", "55_65", "66_100"), include.lowest = TRUE, right = FALSE)) %>%
  drop_na(uof_type, IncidentDistrict, OfficerGender, OfficerRace, AgeBands, subject_race, subject_gender) %>%
  mutate(OfficerRace = str_replace_all(OfficerRace, "/", "_")) %>%
  mutate(OfficerRace = str_replace_all(OfficerRace, " ", "_")) %>%
  mutate(subject_race = str_replace_all(subject_race, " ", "_")) %>%
  mutate(subject_race = str_replace_all(subject_race, "/", "_"))

mpd_dat_2020$IncidentDistrict <- factor(mpd_dat_2020$IncidentDistrict)
mpd_dat_2020$IncidentDistrict <- relevel(mpd_dat_2020$IncidentDistrict, ref = "1D")
mpd_dat_2020$OfficerGender <- factor(mpd_dat_2020$OfficerGender)
mpd_dat_2020$OfficerGender <- relevel(mpd_dat_2020$OfficerGender, ref = "Male")
mpd_dat_2020$OfficerRace <- factor(mpd_dat_2020$OfficerRace)
mpd_dat_2020$OfficerRace <- relevel(mpd_dat_2020$OfficerRace, ref = "White_Caucasian")
mpd_dat_2020$AgeBands <- factor(mpd_dat_2020$AgeBands)
mpd_dat_2020$AgeBands <- relevel(mpd_dat_2020$AgeBands, ref = "18_24")
mpd_dat_2020$subject_race <- factor(mpd_dat_2020$subject_race)
mpd_dat_2020$subject_race <- relevel(mpd_dat_2020$subject_race, ref = "White_Caucasian")
mpd_dat_2020$subject_gender <- factor(mpd_dat_2020$subject_gender)
mpd_dat_2020$subject_gender <- relevel(mpd_dat_2020$subject_gender, ref = "Male")

encoded_data_2020 <- model.matrix(~ IncidentDistrict + OfficerGender + OfficerRace + AgeBands + subject_race + subject_gender, data = mpd_dat_2020)

mpd_dat_enc_2020 <- cbind(mpd_dat_2020, encoded_data)

model_seattle_2020 <- glm(serious ~ IncidentDistrict2D + IncidentDistrict3D + IncidentDistrict4D + IncidentDistrict5D + IncidentDistrict6D + IncidentDistrictOther + OfficerGenderFemale  + OfficerRaceBlack_African_American + OfficerRaceAsian + OfficerRaceHispanic + OfficerRaceOther + OfficerRaceWhite_Caucasian + AgeBands25_34 + AgeBands35_44 + AgeBands45_54 + AgeBands55_65 + AgeBands66_100 + subject_raceBlack_African_American + subject_raceHispanic + subject_raceWhite_Caucasian + subject_genderMale,
               data = mpd_dat_enc_2020)

summary(model_seattle_2020)
```
Seattle
```{r}
sea_dat_2020 <- read.csv('../data/UOF_Seattle.csv')

sea_dat_2020 <- sea_dat_2020 %>%
  mutate(datetime = mdy_hms(Occured_date_time)) %>%
  filter(year(datetime) == 2020) %>%
  drop_na(Incident_Type, Subject_Race, Subject_Gender, Precinct, Sector, Beat) %>%
  mutate(serious = ifelse(Incident_Type == "Level 1 - Use of Force", 0, 1)) %>%
  mutate(Subject_Race = str_replace_all(Subject_Race, "/", "_")) %>%
  mutate(Subject_Race = str_replace_all(Subject_Race, " ", "_")) %>%
  mutate(Subject_Gender = str_replace_all(Subject_Gender, " ", "_")) %>%
  mutate(Subject_Gender = str_replace_all(Subject_Gender, "/", "_")) %>%
  mutate(Subject_Gender = str_replace_all(Subject_Gender, "-", "_"))

encoded_seattle_2020 <- model.matrix(~ Subject_Race + Subject_Gender + Precinct + Sector + Beat, data = sea_dat_2020)

sea_dat_2020_final <- cbind(sea_dat_2020, encoded_seattle_2020)

model_seattle_2020 <- glm(serious ~ Subject_RaceAsian + Subject_RaceBlack_or_African_American + Subject_RaceHispanic_or_Latino + Subject_RaceNat_Hawaiian_Oth_Pac_Islander + Subject_RaceNot_Specified + Subject_RaceTwo_or_More_Races + Subject_RaceWhite + Subject_GenderFemale + Subject_GenderMale + Subject_GenderNon_binary + Subject_GenderOther + Subject_GenderTransgender_Female + Subject_GenderTransgender_Male + Subject_GenderUnknown + Precinct0 + PrecinctEast + PrecinctNorth + PrecinctOOJ + PrecinctSouth + PrecinctSouthwest + PrecinctWest, data = sea_dat_2020_final)

summary(model_seattle_2020)
```
Portland
```{r}
pdx_dat <- read_csv("../data/UOF_Portland.csv")

pdx_dat_2020 <- pdx_dat %>%
  filter(Year == 2020) %>%
  mutate_all(~str_replace_all(., "/", "_")) %>%
  mutate_all(~str_replace_all(., " ", "_")) %>%
  mutate_all(~str_replace_all(., "-", "_")) %>%
  mutate_all(~str_replace_all(., "\\(|\\)", "")) %>%
  rename_all(~str_replace_all(., " ", "_")) %>%
  rename_all(~str_replace_all(., "-", "")) %>%
  rename_all(~str_replace_all(., "/", "_")) %>%
  mutate(Subject_Age = as.numeric(Subject_Age),
    AgeBands = cut(Subject_Age, breaks = age_breaks, labels = c("18_24", "25_34", "35_44", "45_54", "55_65", "66_100"),
                   include.lowest = TRUE, right = FALSE)) %>%
  drop_na(Category_of_Force_Event__Measured_at_Event_Level, Officer_Precinct, Subject__Race, Subject__Sex, Subject__Transient, Subject_Age) %>%
  mutate(serious = ifelse(Category_of_Force_Event__Measured_at_Event_Level == "IV", 0, 1))

encoded_pdx_2020 <- model.matrix(~ Officer_Precinct + Subject__Race + Subject__Sex + Subject__Transient + Subject_Age, data = pdx_dat_2020)

pdx_dat_2020_final <- cbind(pdx_dat_2020, encoded_pdx_2020)

model_portland_2020 <- glm(serious ~ Officer_PrecinctDetectives + Officer_PrecinctEast_Precinct + Officer_PrecinctFamily_Services + Officer_PrecinctK9 + Officer_PrecinctNorth_Precinct + Officer_PrecinctSERT + Officer_PrecinctTOD + Officer_PrecinctTraffic + Officer_PrecinctTraining + Officer_PrecinctTransit_PPB_Only + Subject__RaceBlack + Subject__RaceHispanic + Subject__RaceNative_American + Subject__RaceUnknown + Subject__RaceWhite + Subject__SexMale + Subject__TransientUnknown + Subject__TransientYes + Subject_Age, data = pdx_dat_2020_final)

summary(model_portland_2020)
```
Indianapolis
```{r}
ind_dat <- read_csv("../data/UOF_Indianapolis.csv")

ind_dat_2020 <- ind_dat %>%
  mutate_all(~str_replace_all(., "/", "_")) %>%
  mutate_all(~str_replace_all(., " ", "_")) %>%
  mutate_all(~str_replace_all(., ",", "_")) %>%
  mutate_all(~str_replace_all(., "-", "_")) %>%
  mutate_all(~str_replace_all(., "\\(|\\)", "")) %>%
  mutate_all(~str_replace_all(., ":", "_")) %>%
  mutate_all(~str_replace_all(., "__", "_")) %>%
  mutate(DISTRICT = UDTEXT24B) %>%
  mutate(datetime = ymd(OCCURRED_DT)) %>%
  filter(year(datetime) == 2020) %>%
   mutate(OFF_AGE = as.numeric(OFF_AGE),
    OFF_AGE_BANDS = cut(OFF_AGE, breaks = age_breaks, labels = c("18_24", "25_34", "35_44", "45_54", "55_65", "66_100"),
                   include.lowest = TRUE, right = FALSE)) %>%
  mutate(CIT_AGE = as.numeric(CIT_AGE),
    CIT_AGE_BANDS = cut(CIT_AGE, breaks = age_breaks, labels = c("18_24", "25_34", "35_44", "45_54", "55_65", "66_100"),
                   include.lowest = TRUE, right = FALSE)) %>%
  drop_na(RACE, SEX, OFF_RACE, OFF_SEX, OFF_AGE, OFF_AGE_BANDS, CIT_AGE_BANDS, UOF_FORCE_TYPE)

serious_cats <- c("Less_Lethal_Pepperball", "Lethal_Handgun", "Canine_Bite", "Less_Lethal_Bean_Bag", "Physical_Take_Down",
                  "Less_Lethal_CS_OC", "Physical_Kick", "Less_Lethal_CS_Fogger", "Physical_Leg_Sweep",
                  "Physical_Fist_Strike", "Less_Lethal_Taser", "Physical_Knee_Strike", "Physical_Elbow_Strike", 
                  "Physical_Palm_Strike", "Less_Lethal_Clearout_OC", "Lethal_Rifle", "Less_Lethal_Baton", 
                  "Less_Lethal_BPS_Gas", "Less_Lethal_Burning_CS", "Lethal_Shotgun", "Less_Lethal_CS_Grenade")

ind_dat_2020 <- ind_dat_2020 %>% 
  mutate(serious = as.integer(UOF_FORCE_TYPE %in% serious_cats))

ind_dat_2020$RACE <- factor(ind_dat_2020$RACE)
ind_dat_2020$RACE <- relevel(ind_dat_2020$RACE, ref = "White")
ind_dat_2020$SEX <- factor(ind_dat_2020$SEX)
ind_dat_2020$SEX <- relevel(ind_dat_2020$SEX, ref = "Male")
ind_dat_2020$OFF_RACE <- factor(ind_dat_2020$OFF_RACE)
ind_dat_2020$OFF_RACE <- relevel(ind_dat_2020$OFF_RACE, ref = "White")
ind_dat_2020$OFF_SEX <- factor(ind_dat_2020$OFF_SEX)
ind_dat_2020$OFF_SEX <- relevel(ind_dat_2020$OFF_SEX, ref = "Male")
ind_dat_2020$OFF_AGE_BANDS <- factor(ind_dat_2020$OFF_AGE_BANDS)
ind_dat_2020$OFF_AGE_BANDS <- relevel(ind_dat_2020$OFF_AGE_BANDS, ref = "18_24")
ind_dat_2020$CIT_AGE_BANDS <- factor(ind_dat_2020$CIT_AGE_BANDS)
ind_dat_2020$CIT_AGE_BANDS <- relevel(ind_dat_2020$CIT_AGE_BANDS, ref = "18_24")

encoded_ind_2020 <- model.matrix(~ RACE + SEX + OFF_RACE + OFF_SEX + OFF_AGE_BANDS + CIT_AGE_BANDS, data = ind_dat_2020)

ind_dat_2020_final <- cbind(ind_dat_2020, encoded_ind_2020)

model_indianapolis_2020 <- glm(serious ~ RACEAsian + RACEBi_racial + RACEBlack + RACEHispanic + RACENative_Amer + RACEOther + RACEUnknown + SEXFemale + OFF_RACEBlack + OFF_RACEHispanic + OFF_RACEAsian + OFF_RACEOther + OFF_SEXFemale + OFF_AGE_BANDS25_34 + OFF_AGE_BANDS35_44 + OFF_AGE_BANDS45_54 + OFF_AGE_BANDS55_65 + OFF_AGE_BANDS66_100 + CIT_AGE_BANDS25_34 + CIT_AGE_BANDS35_44 + CIT_AGE_BANDS45_54 + CIT_AGE_BANDS55_65 + CIT_AGE_BANDS66_100, data = ind_dat_2020_final)

summary(model_indianapolis_2020)
```